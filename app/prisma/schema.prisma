// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Farm {
  id             Int      @id @default(autoincrement())
  name           String
  businessName   String?
  lotSectionPlan String[]
  abn            String?
  acn            String?
  pic            String?
  // livestockUnits LivestockUnit[]
  // paddocks       Paddock[]
  users          User[]
}

model User {
  id            Int      @id @default(autoincrement())
  firstName     String
  preferredName String?
  lastName      String
  farm          Farm     @relation(fields: [farmId], references: [id])
  farmId        Int      @unique
}

model Graze {
  id                Int       @id @default(autoincrement())
  startDatetime     DateTime
  endDateTime       DateTime?
  paddock           Paddock   @relation(fields: [paddockId], references: [id])
  paddockId         Int       @unique
  mobIds            Int[]
  mob               Mob[]     @relation(fields: [mobIds], references: [id])
  dseDaysPerHectare Float?
}

model Breed {
  id              Int            @id @default(autoincrement())
  name            String
  class           StockClass
  members         LivestockUnit? @relation(fields: [livestockUnitId], references: [id])
  livestockUnitId Int?           @unique
}

model Mob {
  id       Int             @id @default(autoincrement())
  name     String?
  members  LivestockUnit[]
  comment  String?
  grazeIds Int[]
  graze    Graze[]         @relation(fields: [grazeIds], references: [id])
}

model LivestockUnit {
  id                           Int                            @id @default(autoincrement())
  nlisId                       String?                        @unique
  visualIdLine1                String?
  visualIdLine2                String?
  visualIdLine3                String?
  visualIdBackgroundColour     VisualIdColour?
  visualIdTextColour           VisualIdColour?
  class                        StockClass
  breed                        Breed?
  name                         String?
  comment                      String?
  sex                          Sex
  birthDate                    DateTime
  desexed                      Boolean
  sireId                       Int?                           @unique
  sire                         LivestockUnit?                 @relation("SIRED", fields: [sireId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  sired                        LivestockUnit[]                @relation("SIRED")
  damId                        Int?                           @unique
  dam                          LivestockUnit?                 @relation("BIRTHED", fields: [damId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  birthed                      LivestockUnit[]                @relation("BIRTHED")
  mob                          Mob?                           @relation(fields: [mobRef], references: [id])
  mobRef                       Int?
  pregnancy                    Pregnancy[]                    @relation(fields: [pregnancyId], references: [id])
  pregnancyId                  Int[]
  weights                      WeightRecord[]
  treatments                   ChemicalTreatment[]
  drySheepEquivalent           Int                            @default(1)
  purchasePrice                Float?
  purchaseDate                 DateTime?
  angusTechId                  String?
  active                       Boolean                        @default(true)
  estimatedBreedingValueResult EstimatedBreedingValueResult[]
  // farm                         Farm                           @relation(fields: [farmId], references: [id])
  // farmId                       Int                            @unique
}

model Pregnancy {
  id                         Int             @id @default(autoincrement())
  earliestPossibleConception DateTime?
  latestPossibleConception   DateTime?
  conception                 DateTime?
  dueDate                    DateTime?
  earliestPossibleBirth      DateTime?
  latestPossibleBirth        DateTime?
  parentId                   Int[]           @unique
  parents                    LivestockUnit[] @relation(fields: [parentId], references: [id])
  pregnancySireId            Int
  pregnancyTest              PregnancyTest[]
}

model PregnancyTest {
  id          Int                 @id @default(autoincrement())
  testDate    DateTime
  testType    PregnancyTestType
  resultDate  DateTime
  result      PregnancyTestResult
  pregnancyId Int                 @unique
  pregnancy   Pregnancy           @relation(fields: [pregnancyId], references: [id])
  cost        Float?
}

enum PregnancyTestResult {
  PREGNANT
  NOT_PREGNANT
  INCONCLUSIVE
}

enum PregnancyTestType {
  MANUAL_RECTAL_PALPATATION
  ULTRASOUND
  BIOPRYN
}

model ChemicalTreatment {
  id                Int               @id @default(autoincrement())
  liveStockUnit     LivestockUnit     @relation(fields: [livestockUnitId], references: [id])
  livestockUnitId   Int               @unique
  treatmentDate     DateTime
  applicationMethod ApplicationMethod
  product           ChemicalProduct   @relation(fields: [chemicalProductId], references: [id])
  chemicalProductId Int               @unique
  volumeMl          Int
}

model ChemicalProduct {
  id                   Int                  @id @default(autoincrement())
  manufacturer         ChemicalManufacturer
  productName          ChemicalProductName
  serialNumber         String?              @unique
  batchNumber          String?
  volumeMl             Int?
  cost                 Float?
  type                 ChemicalType
  witholdingPeriodDays Int                  @default(0)
  activeIngredients    ActiveIngredient[]
  ChemicalTreatment    ChemicalTreatment[]
}

model ActiveIngredient {
  id         Int             @id @default(autoincrement())
  ingredient Ingredient
  mgPermL    Float
  product    ChemicalProduct @relation(fields: [productId], references: [id])
  productId  Int
}

model EstimatedBreedingValueDefinition {
  id                           Int                            @id @default(autoincrement())
  name                         String
  code                         String
  category                     EbvCategory
  description                  String
  higherIsBetter               Boolean
  units                        Units
  measurement                  Measurement
  angusTechFieldNameValue      String?
  angusTechFieldNamePercentile String?
  angusTechFieldNameAccuracy   String?
  results                      EstimatedBreedingValueResult[]
}

model EstimatedBreedingValueResult {
  id                                 Int                              @id @default(autoincrement())
  ebv                                EstimatedBreedingValueDefinition @relation(fields: [estimatedBreedingValueDefinitionId], references: [id])
  estimatedBreedingValueDefinitionId Int
  value                              Float
  percentile                         Float
  accuracy                           Float
  livestockUnit                      LivestockUnit                    @relation(fields: [livestockUnitId], references: [id])
  livestockUnitId                    Int
}

enum Units {
  KILOGRAMS
  DAYS
  PERCENTAGE
  CENTIMETRES
  SQUARE_CENTIMETRES
  MILLIMETRES
  KILOGRAMS_PER_DAY
  STRUCTURAL_SCORE
  DOLLARS_AUSTRALIAN
}

enum Measurement {
  CARCASE_WEIGHT
  LIVE_WEIGHT
  CIRCUMFERENCE
  CALVING_UNASSISTED
  GESTATION
  DOCILE_CALVES
  MUSCLE_AREA
  FAT_DEPTH
  SALEABLE_BEEF
  INTRAMUSCULAR_FAT
  FEED_CONSUMED
  CLAW_SET
  FOOT_ANGLE
  LEG_ANGLE
  JOINING_TO_CALVING
  NET_PROFITABILITY
}

enum EbvCategory {
  CALVING_EASE
  GROWTH
  FERTILITY
  TEMPERAMENT
  CARCASE
  FEED_EFFICIENCY
  STRUCTURAL
  SELECTION_INDEX
}

enum Ingredient {
  TRICLABENDAZOLE
  ABAMECTIN
}

enum ChemicalType {
  DRENCH
  VACCINE
  SUPPLEMENT
  ANTIBIOTICS
}

enum ApplicationMethod {
  ORAL
  TRANSDERMAL
  SUB_CUT_INJECTION
  INTRAVENUS_INJECTION
}

enum VisualIdColour {
  WHITE
  ORANGE
  LIGHT_GREEN
  PURPLE
  YELLOW
  RED
  SKY_BLUE
  BLACK
}

model Paddock {
  id                      Int                    @id @default(autoincrement())
  name                    String
  polygon                 GeoPoint[]
  areaHa                  Float
  graze                   Graze[]
  livestockUnitPosition   LivestockUnitPosition? @relation(fields: [livestockUnitPositionId], references: [id])
  livestockUnitPositionId Int?                   @unique
  // farm                    Farm                   @relation(fields: [farmId], references: [id])
  // farmId                  Int                    @unique
}

model LivestockUnitPosition {
  id       Int       @id @default(autoincrement())
  date     DateTime
  location GeoPoint?
  paddock  Paddock?
}

model GeoPoint {
  id                      Int                    @id @default(autoincrement())
  latitude                Float
  longitude               Float
  paddock                 Paddock                @relation(fields: [paddockId], references: [id])
  paddockId               Int                    @unique
  livestockUnitPosition   LivestockUnitPosition? @relation(fields: [livestockUnitPositionId], references: [id])
  livestockUnitPositionId Int?                   @unique
}

model WeightRecord {
  id              Int           @id @default(autoincrement())
  weight          Float
  dateMeasured    DateTime      @default(now())
  method          WeighMethod   @default(SCALES)
  livestockUnit   LivestockUnit @relation(fields: [livestockUnitId], references: [id])
  livestockUnitId Int           @unique
}

model LoraDevice {
  id               Int                  @id @default(autoincrement())
  name             String?
  deviceId         String
  deviceEui        String
  appEui           String
  appKey           String
  manufacturer     String?
  partNumber       String?
  activationMethod LoraActivationMethod @default(OTAA)
}

enum ChemicalManufacturer {
  BOEHRINGER_INGLEHEIM
}

enum ChemicalProductName {
  AVOMEC_PLUS_POUR_ON
}

enum LoraActivationMethod {
  OTAA
  ABP
}

enum StockClass {
  CATTLE
  SHEEP
  GOAT
  CAMEL
  ALPACA
  LLAMA
  CHICKEN
  DUCK
  TURKEY
}

enum WeighMethod {
  SCALES
  IMAGE_ANALYSIS
  VISUAL_ESTIMATE
  MOB_AVERAGE
}

enum Sex {
  MALE
  FEMALE
}
